# [v0.0.12]_FIX_SERVICES_DobleEmisionComandaActualizada_RESUELTO.md

## Problema
Al abrir o cerrar una comanda, el evento `comanda_actualizada` se emitía dos veces desde el backend (`tpv_service.py`), provocando recargas dobles y efectos visuales indeseados en la UI (parpadeos, lentitud, ventanas emergentes).

## Causa
- Se emitía `mesa_event_bus.comanda_actualizada.emit(comanda)` tanto en `persistir_comanda` como en los métodos de alto nivel (`crear_comanda`, `pagar_comanda`, etc.).
- Esto generaba dos eventos por cada acción de negocio.

## Solución aplicada
- Se eliminó la emisión redundante en `persistir_comanda`. Ahora solo los métodos de alto nivel emiten el evento.
- Se documenta la excepción funcional y se deja un TODO para refactorizar la función en la siguiente versión.

## Protocolo de excepción
- [x] Documentar la razón técnica específica (ver arriba)
- [x] Crear plan de cumplimiento futuro: Refactorizar para que ningún método de persistencia emita señales globales, solo devuelvan estado.
- [x] Registrar la excepción en este README y en el README de `src/services`.
- [x] Añadir TODO comment en el código afectado.
- [x] Programar refactorización para versión >= v0.0.13

## Estado: RESUELTO

---

> Última actualización: 2025-07-09

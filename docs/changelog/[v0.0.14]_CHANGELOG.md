# [v0.0.14] Changelog - Sistema Hefest

> ‚ö†Ô∏è **Esta versi√≥n sigue en desarrollo activo. Se podr√°n a√±adir m√°s elementos, fixes y mejoras antes del cierre definitivo de la release.**

## Fecha de release: Julio 2025

### Estado: üöß En desarrollo

---

## üÜï Cambios principales

- **Estandarizaci√≥n global del identificador de mesa:**
  - El identificador √∫nico de mesa es ahora siempre el campo string `numero` (ej: "T01").
  - Eliminado el uso de `mesa.id` como identificador de negocio; se mantiene solo como referencia interna.
  - Refactorizaci√≥n de modelos, l√≥gica, controladores, servicios y UI para operar √∫nicamente con `numero`.
- **Refactorizaci√≥n de modelos y servicios:**
  - Modelo `Mesa` actualizado en `core/hefest_data_models.py` y `services/tpv_service.py`.
  - M√©todos auxiliares para eliminar y buscar mesas por `numero`.
  - Carga de datos de prueba y migraciones adaptadas al nuevo identificador.
- **Refactorizaci√≥n de UI y controladores:**
  - Todos los widgets y controladores de mesas usan `numero` como identificador √∫nico.
  - Propagaci√≥n y sincronizaci√≥n de reservas y eventos usando `numero`.
  - Correcci√≥n de propagaci√≥n de identificador en eventos, reservas y widgets.
- **Fixes y mejoras:**

  - [FIX] Eliminada la doble emisi√≥n del evento `comanda_actualizada` en `tpv_service.py` para evitar recargas dobles y parpadeos en la UI.
  - [FIX] Centralizado el refresco de UI de mesas en `refresh_mesas()` y eliminado refrescos redundantes.
  - [FIX] Corregida la recursi√≥n infinita en `refresh_mesas()`.
  - [FIX] Priorizaci√≥n correcta del estado "ocupada" sobre "reservada" en la l√≥gica de refresco de mesas.
  - [FIX] Tras cancelar una reserva, la UI de mesas se actualiza correctamente gracias a la emisi√≥n del evento y refresco tras el commit.
  - [FIX] Ajustado el filtro de reservas activas para que solo se consideren reservas con estado "activa".
  - [FIX] Eliminados logs de debug/info innecesarios en los m√≥dulos implicados (`mesas_area_main.py`, `reserva_service.py`, `mesa_widget_simple.py`).
  - [FIX] Documentados los fixes en `docs/development/fixes/` seg√∫n la pol√≠tica de excepciones funcionales.
  - [FIX] Validado que tras cancelar una reserva, la mesa pasa a estado "libre" sin desfases ni parpadeos.
  - [FIX] El commit de la cancelaci√≥n de reserva se realiza antes de emitir el evento, garantizando sincronizaci√≥n visual inmediata.

---

## üõ†Ô∏è Excepciones funcionales documentadas

- Se mantiene `mesa.id` como referencia interna solo para compatibilidad t√©cnica y persistencia.
- TODO: Refactorizar legacy/compatibilidad cuando se eliminen dependencias de `id` en futuras versiones.

---

## üß™ Validaciones realizadas

- Validaci√≥n de persistencia y funcionamiento de todos los elementos del sistema.
- Pruebas de carga de datos, migraciones y compatibilidad.
- Validaci√≥n visual y funcional de widgets, controladores y servicios.

---

## üßπ Limpieza y organizaci√≥n continua (julio 2025)

- Eliminaci√≥n de logs antiguos y archivos de pruebas.
- Reubicaci√≥n de scripts de migraci√≥n y fixes fuera de `data/` hacia `docs/archive/legacy_cleaned_20250708/`.
- Cumplimiento estricto de la pol√≠tica de carpetas: solo datos y backups en `data/`.
- Proceso de limpieza y organizaci√≥n sigue en curso.

---

## üóíÔ∏è Notas adicionales

- Todos los cambios cumplen la pol√≠tica de nomenclatura, estructura y documentaci√≥n.
- No se detectaron duplicados ni conflictos de identificadores.
- Se recomienda revisar dependencias externas que puedan usar `id` como identificador de negocio.

---

## üë§ Autor√≠a y revisi√≥n

- Refactor y fixes: Equipo principal de desarrollo Hefest
- Revisi√≥n QA: Julio 2025

---

> Documento generado y validado seg√∫n las pol√≠ticas de changelog y compliance del proyecto.

---

> Este changelog se ir√° actualizando conforme avance el desarrollo de la versi√≥n 0.0.14.
